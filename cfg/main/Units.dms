////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// Dit is RSOpen, de open source versie van het model RuimteScanner. Het scipt wordt uitgegeven onder GNU-GPL licentie.
//
// RSOpen is ontwikkeld door PBL Planbureau voor de Leefomgeving, i.s.m Object Vision B.V. en VU Vrije Universiteit Amsterdam.
// Opdrachtgever/ontwikkelaar PBL: Bart Rijken
// Contactpersoon/ontwikkelaar Object Vision B.V.: Jip Claassens (jclaassens@objectvision.nl)
// Contacpersoon PBL: Bas van Bemmel (Bas.vanBemmel@pbl.nl)
//
// Deze file bevat een reeks Units, inclusief metriek en relaties. Ze worden in het model gebruikt om:
// 1. te voorkomen dat andersoortige entiteiten op elkaar worden betrokken (Woningen en banen optellen bijv.), en
// 2.  gemakkelijk te kunenn (des)aggregeren, (van GW naar MW bijv). 
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


container Units
{
	unit<Float32> meter     := BaseUnit('m', float32);
	unit<Float64> meter_f64 := BaseUnit('m', float64);
	unit<Int32>   NrMeter   := BaseUnit('m', int32);
	
	unit<Float32> hm := 100.0 * meter;
	unit<Float32> km := 1000.0 * meter;
	unit<Float32> cm := 0.01 * meter;
	unit<Float32> mm := 0.001 * meter;

	unit<Float32> meter2       := meter * meter;
	unit<Float64> meter2_f64   := meter_f64 * meter_f64;
	unit<Float32> m2_Footprint := meter2;
	unit<Int32>   NrMeter2 := NrMeter * NrMeter;
	unit<Float32> km2    := km * km;
	unit<Float32> ha     := 10000.0 * meter2, Label = "Hectare";
	unit<Int32>   NrHa   := 10000 * NrMeter2;
	unit<Float32> per_ha := 1.0 / ha;
	unit<Float32> meter3       := meter * meter * meter;
	
	unit<Float32> g      := BaseUnit('g', float32),   Label = "gram", Descr = "SI base unit for weight";
	unit<Float32> kg     := 1000 * g;
	
	unit<Float32> s   := BaseUnit('s', float32),   Label = "second", Descr = "SI base unit for time";
	unit<Float32> sec := BaseUnit('s', float32);
	unit<Float32> min := 60 * sec;
	unit<Float32> uur := 60 * min;
	unit<Float32> dag := 24 * uur;
	
	unit<Float32> jaar:= BaseUnit('Yr', float32);
	unit<UInt16>  yr  := BaseUnit('Yr', UInt16);
	unit<Float32> maand := (1.0/12.0) * jaar;
	unit<Float32> jaarlijks:= 1.0 / jaar;
	
	unit<Float32> mm_dag := mm / dag;
	
	unit<Int16>  YearRange     := Range(jaar,  1900s, 2200s);
	unit<Int16>  YearDiffRange := Range(jaar, -100s,  100s);
	
//	monetary
	unit<Float32> Eur          := BaseUnit('EurO', float32);
	unit<Int32>   NrEur        := BaseUnit('EurO', int32);
	unit<Float32> kEur         := 1000.0 * Eur;
	unit<Float32> mldEur       := 1000000.0 * kEur;
	unit<Float32> Eur_m2       := Eur / meter2;
	unit<Float32> Eur_m        := Eur / meter;
	unit<Float32> Eur_ha       := Eur / ha;
	unit<Float32> Eur_object   := Eur / verblijfsobject;
	unit<Int32>   NrEur_ha         := NrEur / NrHa;
	unit<Int32>   NrEur_Woning     := NrEur / NrWoningen;
	unit<Float32> Eur_Woning       := Eur / Woning;
	unit<Float32> Eur_jaarlijks    := Eur / jaar;
	unit<Float32> Eur_yr           := Eur / jaar;
	unit<Float32> Eur_m2_jaarlijks := Eur_m2 / jaar;
	unit<Float32> kEur_Ha          := 1000.0 * Eur_Ha;
	unit<Float32> mEur_Ha          := 1000.0 * kEur_Ha;
	unit<Float32> Eur_Km           := Eur / Km;

	unit<Float32> ton              := BaseUnit('ton', float32);
	unit<Float32> Eur_ton          := Eur / ton;
	unit<Float32> ton_jaarlijks    := ton / jaar;
	unit<Float32> ton_ha           := ton / ggHa;
	unit<Float32> ton_ha_jaarlijks := ton_ha / jaar;
	unit<Float32> ggHa             := 10000.0 * meter * meter; //,       cdf = "Classifications/Hectare/K9/Classes";
	unit<Float32> Eur_Ha_jaarlijks := Eur_Ha / jaar;
	unit<Float32> Eur_ggHa         := Eur / ggHa;
	unit<Float32> meterbd          := BaseUnit('m', float32); //,        cdf = "Classifications/Altitude/bd13K/Classes";
	unit<Float32> meterhoogte      := BaseUnit('m', float32); //,        cdf = "Classifications/Altitude/hoogte7K/Classes";


// ============ Actor and Object based Units
	unit<Float32> Job                 := BaseUnit('Job', float32);
	unit<Int32>   NrJobs              := BaseUnit('Job', int32);
	unit<Float32> Job_min             := Job / min;
	unit<Float32> Job_ha              := Job / ha;
	unit<Int32>   FTE                 := BaseUnit('FTE', int32);
	unit<Float32> Persoon             := BaseUnit('P', float32);
	unit<Int32>   NrPersonen          := BaseUnit('P', int32);
	unit<Float32> Household           := BaseUnit('HH', float32);
	unit<Int32>   NrHouseholds        := BaseUnit('HH', int32);
	unit<Float32> Woning              := BaseUnit('W', float32);
	unit<Int32>   NrWoningen          := BaseUnit('W', int32);
	unit<Int32>   NrWoningenHa        := NrWoningen / NrHa;
	unit<Float32> Persoon_Ha          := Persoon / ha;
	unit<Float32> Verblijfsobject     := BaseUnit('VBO', float32);
	unit<Float32> PandUnit            := BaseUnit('Pand', float32);
	unit<Float32> vbo_ha              := Verblijfsobject / ha;
	unit<Int32>   NrVerblijfsobjecten := BaseUnit('VBO', int32);
	
	unit<Float32> Household_Woning    := Household / Woning;
	unit<Float32> Woning_Household    := Woning / Household;
	unit<Float32> Persoon_Household   := Persoon / Household;
	unit<Float32> Persoon_Woning      := Persoon / Woning;
	unit<Float32> NrWoningen_ha       := NrWoningen  / ha;
	unit<Float32> m2_ha               := meter2  / ha;
	unit<Float32> NrJobs_ha           := Job     / ha;
	     
	unit<Float32> Inw_ha              := Persoon / ha;
	unit<Float32> m2BVO_job           := m2BVO / Job;
	unit<Float32> m2_Job              :=  meter2 / Job;
	unit<Float32> m2_Footprint_job    := m2_Footprint / Job;
	unit<Float32> m2PandFootprint     := meter2;
	unit<Float32> m2PandFootprint_job := m2PandFootprint / Job, Descr = "m2 pandfootprint per baan";
	unit<Float32> job_m2PandFootprint := Job / m2PandFootprint;
	unit<Float32> m2PandFootprint_ha  := m2PandFootprint / ha;
	unit<Float32> m2_Vbo              := meter2 / Verblijfsobject;
	unit<Float32> m2_Woning           := meter2 / Woning;
	unit<Float32> Vbo_m2              := Verblijfsobject / meter2;
	unit<Float32> ha_Vbo              := ha / Verblijfsobject;
	unit<Float32> ha_Woning           := ha / Woning;
	unit<Float32> eur_Vbo             := Eur / Verblijfsobject;
	unit<Float32> m2_pand             := meter2 / PandUnit;
	unit<Float32> m2_FTE              := meter2 / FTE;
	unit<Float32> FTE_ha              := NrJobs / ha;
	
	unit<Float32> m2PandFootprint_object := m2PandFootprint / Verblijfsobject;
	unit<Float32> Ha_object              := Ha / Verblijfsobject;
	
	//
	unit<Float32> Terreinoppervlak := meter2;
	unit<Float32> m2BVO := meter2; // Bruto Vloeroppervlak
	unit<Float32> Woonoppervlak := meter2;  // = GBO = gebruiksoppervlak
	unit<Float32> Woonoppervlak_ha := meter2 / ha;  
	unit<Float32> Perceeloppervlak := meter2;  // = GBO = gebruiksoppervlak
	unit<Float32> Woonoppervlak_m2BVO := Woonoppervlak / m2BVO; // vormfactor
	unit<Float32> Woning_ha := Woning / ha;
	unit<Float32> m2BVO_Woning := m2BVO / Woning;
	unit<Float32> Woonoppervlak_Woning := Woonoppervlak / Woning;
	unit<Float32> FSI := m2BVO / Terreinoppervlak; //FloorSpaceIndex
	unit<Float32> GSI := m2PandFootprint / Terreinoppervlak; //GroundSpaceIndex
	unit<Float32> Perceeloppervlak_Woning := Perceeloppervlak / Woning;
	//
	
	unit<Float32> Ratio   := 1.0 * ha / ha;
	unit<Float32> Percent := 0.01 * Ratio;
	
	unit<String>  string_t;
	unit<Float32> float32_t;
	unit<Bool>    bool_t;
	unit<UInt2>   uint2_t;
	unit<UInt8>   uint8_t;
	unit<UInt16>  UInt16_t;
	unit<UInt32>  uint32_t;
	
	unit<UInt32>   MaatregelK := Classifications/Modellering/MaatregelK;
	
	// Energie
	unit<UInt8>   Energielabel := Classifications/Vastgoed/Energielabel;
	unit<Float32> Joule  := BaseUnit('joule', float32);
	unit<Float32> TJoule := 1000000000000.0 * Joule;
	unit<Float32> J      := BaseUnit('J', float32), Label = "Joule", Descr = "SI unit for energy";
	
	unit<Float32> kJ    := 1000 * J;
	unit<Float32> MJ    := 1000 * kJ;
	unit<Float32> MJ_yr := MJ / yr;
	unit<Float32> GJ    := 1000 * MJ;
	unit<Float32> PJ    := 1000000 * GJ;
	
	unit<Float32> W      := J / s, Label = "Watt", Descr = "SI unit for power";
	unit<Float32> kW     := 1000 * W;
	unit<Float32> MW     := 1000 * kW;
	unit<Float32> GW     := 1000 * MW;
	unit<Float32> TW     := 1000 * GW;
	unit<Float32> GWh    := uur * GW;
	unit<Float32> TWh    := uur * TW;
	
	unit<Float32> MW_km2 := MW / km2;
	unit<Float32> MW_ha  := MW / ha;
	unit<Float32> ha_ha  := ha / ha;
	
	unit<Float32> Mol := BaseUnit('mol', float32);
	unit<Float32> Mol_ha    := Mol / ha;
	unit<Float32> Mol_ha_yr := Mol_ha / yr;
	

	unit<Float32> m_s       := meter  / s;
	unit<Float32> km_hr     := km / uur;
	
	unit<Float32> kg_m2     := kg / meter2;
	unit<Float32> kg_pand   := kg / pandunit;
	
	unit<Float32> m3_m2     := meter3 / meter2;

	Template Classify_9K_Eur
	{
		//
		attribute<Eur> target (domain);
		unit<UInt32> domain;
		//
		
		attribute<Eur> ClassifyJf (Target_9K) := ClassifyJenksFisher(target, Target_9K);
		parameter<UInt32> max := max(ClassifyJf)[uint32];
		parameter<UInt32> max_strlen := strlen(string(max));
		parameter<uint64> power := (10d^(max_strlen[float64]-4d))[uint64];
		attribute<Eur> ClassifyJf_rounded (Target_9K) := ((ClassifyJf[uint64] / power) * power)[Eur];
		attribute<UInt32> ClassifyJf_rounded_integer (Target_9K) := ((ClassifyJf[uint64] / power) * power)[uint32];
		
		unit<UInt8> Target_9K : NrOfRows = 9
		{
			parameter<String> dash := ' - ';
			parameter<String> comma := ',';
			attribute<String> Label_src := id(.) == (#target_9K[uint8] - 1b) ? string(ClassifyJf_rounded_integer) + ' or more' : string(ClassifyJf_rounded_integer) + dash + string(ClassifyJf_rounded_integer)[id(.) + 1b];
			attribute<String> Label := replace(
				Label_src, '00000000000','00.000.000.000'
						 , '0000000000' , '0.000.000.000'
						 , '000000000'  ,  '.000.000.000'
						 , '00000000'   ,    '00.000.000'
						 , '0000000'    ,     '0.000.000'
						 , '000000'     ,      '.000.000'
						 , '00000'      ,        '00.000'
						 , '0000'       ,         '0.000'
			), DialogType = "LabelText";
			
			attribute<UInt32>   PenColor   := BrushColor, DialogType = "PenColor";
			attribute<UInt32>   BrushColor :
			[
				rgb(255,255,229),
				rgb(255,247,188),
				rgb(254,227,145),
				rgb(254,196,79) ,
				rgb(254,153,41) ,
				rgb(236,112,20) ,
				rgb(204,76,2)   ,
				rgb(153,52,4)   ,
				rgb(102,37,6)
			], DialogType = "BrushColor";
			
			attribute<Eur> ClassBreaks  := ClassifyJf_rounded , DialogType = "Classification";
		}
	}
}